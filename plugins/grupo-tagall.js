/* 
- tagall By Angel-OFC  
- etiqueta en un grupo a todos con banderas ðŸ‡ºðŸ‡¸
- https://whatsapp.com/channel/0029VaJxgcB0bIdvuOwKTM2Y
*/
const handler = async (m, { isOwner, isAdmin, conn, text, participants, args, command, usedPrefix }) => {
  if (usedPrefix == 'a' || usedPrefix == 'A') return;

  const customEmoji = global.db.data.chats[m.chat]?.customEmoji || 'ðŸ«';
  m.react(customEmoji);

  if (!(isAdmin || isOwner)) {
    global.dfail('admin', m, conn);
    throw false;
  }

  // FunciÃ³n para obtener la bandera segÃºn el prefijo telefÃ³nico
  function getFlagFromNumber(number) {
    const countryFlags = {
      '1': 'ðŸ‡ºðŸ‡¸', '7': 'ðŸ‡·ðŸ‡º', '20': 'ðŸ‡ªðŸ‡¬', '27': 'ðŸ‡¿ðŸ‡¦',
      '30': 'ðŸ‡¬ðŸ‡·', '31': 'ðŸ‡³ðŸ‡±', '32': 'ðŸ‡§ðŸ‡ª', '33': 'ðŸ‡«ðŸ‡·', '34': 'ðŸ‡ªðŸ‡¸',
      '36': 'ðŸ‡­ðŸ‡º', '39': 'ðŸ‡®ðŸ‡¹', '40': 'ðŸ‡·ðŸ‡´', '41': 'ðŸ‡¨ðŸ‡­', '43': 'ðŸ‡¦ðŸ‡¹',
      '44': 'ðŸ‡¬ðŸ‡§', '45': 'ðŸ‡©ðŸ‡°', '46': 'ðŸ‡¸ðŸ‡ª', '47': 'ðŸ‡³ðŸ‡´', '48': 'ðŸ‡µðŸ‡±',
      '49': 'ðŸ‡©ðŸ‡ª', '51': 'ðŸ‡µðŸ‡ª', '52': 'ðŸ‡²ðŸ‡½', '53': 'ðŸ‡¨ðŸ‡º', '54': 'ðŸ‡¦ðŸ‡·',
      '55': 'ðŸ‡§ðŸ‡·', '56': 'ðŸ‡¨ðŸ‡±', '57': 'ðŸ‡¨ðŸ‡´', '58': 'ðŸ‡»ðŸ‡ª', '60': 'ðŸ‡²ðŸ‡¾',
      '61': 'ðŸ‡¦ðŸ‡º', '62': 'ðŸ‡®ðŸ‡©', '63': 'ðŸ‡µðŸ‡­', '64': 'ðŸ‡³ðŸ‡¿', '65': 'ðŸ‡¸ðŸ‡¬',
      '66': 'ðŸ‡¹ðŸ‡­', '81': 'ðŸ‡¯ðŸ‡µ', '82': 'ðŸ‡°ðŸ‡·', '84': 'ðŸ‡»ðŸ‡³', '86': 'ðŸ‡¨ðŸ‡³',
      '90': 'ðŸ‡¹ðŸ‡·', '91': 'ðŸ‡®ðŸ‡³', '92': 'ðŸ‡µðŸ‡°', '93': 'ðŸ‡¦ðŸ‡«', '94': 'ðŸ‡±ðŸ‡°',
      '95': 'ðŸ‡²ðŸ‡²', '98': 'ðŸ‡®ðŸ‡·', '211': 'ðŸ‡¸ðŸ‡¸', '212': 'ðŸ‡²ðŸ‡¦', '213': 'ðŸ‡©ðŸ‡¿',
      '216': 'ðŸ‡¹ðŸ‡³', '218': 'ðŸ‡±ðŸ‡¾', '220': 'ðŸ‡¬ðŸ‡²', '221': 'ðŸ‡¸ðŸ‡³', '222': 'ðŸ‡²ðŸ‡·',
      '223': 'ðŸ‡²ðŸ‡±', '224': 'ðŸ‡¬ðŸ‡³', '225': 'ðŸ‡¨ðŸ‡®', '226': 'ðŸ‡§ðŸ‡«', '227': 'ðŸ‡³ðŸ‡ª',
      '228': 'ðŸ‡¹ðŸ‡¬', '229': 'ðŸ‡§ðŸ‡¯', '230': 'ðŸ‡²ðŸ‡º', '231': 'ðŸ‡±ðŸ‡·', '232': 'ðŸ‡¸ðŸ‡±',
      '233': 'ðŸ‡¬ðŸ‡­', '234': 'ðŸ‡³ðŸ‡¬', '235': 'ðŸ‡¹ðŸ‡©', '236': 'ðŸ‡¨ðŸ‡«', '237': 'ðŸ‡¨ðŸ‡²',
      '238': 'ðŸ‡¨ðŸ‡»', '239': 'ðŸ‡¸ðŸ‡¹', '240': 'ðŸ‡¬ðŸ‡¶', '241': 'ðŸ‡¬ðŸ‡¦', '242': 'ðŸ‡¨ðŸ‡¬',
      '243': 'ðŸ‡¨ðŸ‡©', '244': 'ðŸ‡¦ðŸ‡´', '245': 'ðŸ‡¬ðŸ‡¼', '248': 'ðŸ‡¸ðŸ‡¨', '249': 'ðŸ‡¸ðŸ‡©',
      '250': 'ðŸ‡·ðŸ‡¼', '251': 'ðŸ‡ªðŸ‡¹', '252': 'ðŸ‡¸ðŸ‡´', '253': 'ðŸ‡©ðŸ‡¯', '254': 'ðŸ‡°ðŸ‡ª',
      '255': 'ðŸ‡¹ðŸ‡¿', '256': 'ðŸ‡ºðŸ‡¬', '257': 'ðŸ‡§ðŸ‡®', '258': 'ðŸ‡²ðŸ‡¿', '260': 'ðŸ‡¿ðŸ‡²',
      '261': 'ðŸ‡²ðŸ‡¬', '262': 'ðŸ‡·ðŸ‡ª', '263': 'ðŸ‡¿ðŸ‡¼', '264': 'ðŸ‡³ðŸ‡¦', '265': 'ðŸ‡²ðŸ‡¼',
      '266': 'ðŸ‡±ðŸ‡¸', '267': 'ðŸ‡§ðŸ‡¼', '268': 'ðŸ‡¸ðŸ‡¿', '269': 'ðŸ‡°ðŸ‡²', '350': 'ðŸ‡¬ðŸ‡®',
      '351': 'ðŸ‡µðŸ‡¹', '352': 'ðŸ‡±ðŸ‡º', '353': 'ðŸ‡®ðŸ‡ª', '354': 'ðŸ‡®ðŸ‡¸', '355': 'ðŸ‡¦ðŸ‡±',
      '356': 'ðŸ‡²ðŸ‡¹', '357': 'ðŸ‡¨ðŸ‡¾', '358': 'ðŸ‡«ðŸ‡®', '359': 'ðŸ‡§ðŸ‡¬', '370': 'ðŸ‡±ðŸ‡¹',
      '371': 'ðŸ‡±ðŸ‡»', '372': 'ðŸ‡ªðŸ‡ª', '373': 'ðŸ‡²ðŸ‡©', '374': 'ðŸ‡¦ðŸ‡²', '375': 'ðŸ‡§ðŸ‡¾',
      '376': 'ðŸ‡¦ðŸ‡©', '377': 'ðŸ‡²ðŸ‡¨', '378': 'ðŸ‡¸ðŸ‡²', '380': 'ðŸ‡ºðŸ‡¦', '381': 'ðŸ‡·ðŸ‡¸',
      '382': 'ðŸ‡²ðŸ‡ª', '383': 'ðŸ‡½ðŸ‡°', '385': 'ðŸ‡­ðŸ‡·', '386': 'ðŸ‡¸ðŸ‡®', '387': 'ðŸ‡§ðŸ‡¦',
      '389': 'ðŸ‡²ðŸ‡°', '420': 'ðŸ‡¨ðŸ‡¿', '421': 'ðŸ‡¸ðŸ‡°', '423': 'ðŸ‡±ðŸ‡®', '592': 'ðŸ‡¬ðŸ‡¾',
      '595': 'ðŸ‡µðŸ‡¾', '598': 'ðŸ‡ºðŸ‡¾', '675': 'ðŸ‡µðŸ‡¬', '678': 'ðŸ‡»ðŸ‡º', '686': 'ðŸ‡°ðŸ‡®',
      '850': 'ðŸ‡°ðŸ‡µ', '852': 'ðŸ‡­ðŸ‡°', '853': 'ðŸ‡²ðŸ‡´', '855': 'ðŸ‡°ðŸ‡­', '856': 'ðŸ‡±ðŸ‡¦',
      '880': 'ðŸ‡§ðŸ‡©', '886': 'ðŸ‡¹ðŸ‡¼', '960': 'ðŸ‡²ðŸ‡»', '961': 'ðŸ‡±ðŸ‡§', '962': 'ðŸ‡¯ðŸ‡´',
      '963': 'ðŸ‡¸ðŸ‡¾', '964': 'ðŸ‡®ðŸ‡¶', '965': 'ðŸ‡°ðŸ‡¼', '966': 'ðŸ‡¸ðŸ‡¦', '967': 'ðŸ‡¾ðŸ‡ª',
      '968': 'ðŸ‡´ðŸ‡²', '970': 'ðŸ‡µðŸ‡¸', '971': 'ðŸ‡¦ðŸ‡ª', '972': 'ðŸ‡®ðŸ‡±', '973': 'ðŸ‡§ðŸ‡­',
      '974': 'ðŸ‡¶ðŸ‡¦', '975': 'ðŸ‡§ðŸ‡¹', '976': 'ðŸ‡²ðŸ‡³', '977': 'ðŸ‡³ðŸ‡µ', '992': 'ðŸ‡¹ðŸ‡¯',
      '993': 'ðŸ‡¹ðŸ‡²', '994': 'ðŸ‡¦ðŸ‡¿', '995': 'ðŸ‡¬ðŸ‡ª', '996': 'ðŸ‡°ðŸ‡¬', '998': 'ðŸ‡ºðŸ‡¿'
    };
    for (let len = 3; len >= 1; len--) {
      const code = number.slice(0, len);
      if (countryFlags[code]) return countryFlags[code];
    }
    return 'ðŸ³ï¸'; // bandera blanca si no se encuentra
  }

  const pesan = args.join` `;
  const oi = `*Â» INFO :* ${pesan}`;
  let teks = `*!  MENCION GENERAL  !*\n  *PARA ${participants.length} MIEMBROS* ðŸ—£ï¸\n\n ${oi}\n\nâ•­  â”„ ð…„ Ûªê’° \`â¡žáª²=ÍŸÍŸÍž${botname} â‰¼á³ž×„\` ê’± ÛŸ ð…„ â”„\n`;
  for (const mem of participants) {
    const num = mem.id.split('@')[0];
    const flag = getFlagFromNumber(num);
    teks += `â”Š${flag} @${num}\n`;
  }
  teks += `â•°â¸¼ â”„ â”„ â”„ â”€  ê’°  ×…à­­ *${vs}* à­§ ×… ê’±  â”„  â”€ â”„ â¸¼`;

  conn.sendMessage(m.chat, { text: teks, mentions: participants.map(a => a.id) });
};

handler.help = ['todos *<mensaje>*'];
handler.tags = ['group'];
handler.command = ['todos', 'invocar', 'tagall'];
handler.admin = true;
handler.group = true;

export default handler;